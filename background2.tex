\chapter{Hierarchical Clustering Background}
\label{cha:background2}

\section{Summary}
\label{sec:summary}

In this section we review the relevant terminology and background that is
required for the remainder of this thesis.  We begin with the general theory
of graphs, trees and their relationship to distances and special types of
metrics.  We then look at the problem of reconstructing trees from distances and
finally at the theory of ``lassoing'' a tree from incomplete distance
information.

\section{Graphs, Trees and Distances}
\label{sec:graphs-trees-dist}

\subsection{History}
\label{sec:history}

Trees have been used to represent hierarchical structures for many hundreds of
years \cite{knuth97taocp1}.  One of the most well-known and ubiquitous
occurrences is that of the family tree.  The use of a tree to represent
lineages was widespread in Europe by the 14th Century in Christian artwork
depicted the ancestors of Jesus of Nazareth.  This tree is known as the Tree
of Jesse \cite{corblet1860etude}.

Darwin would later popularise the concept of the more general ``tree of life''
in his seminal work popularly known as \textit{On the Origin of Species}
\cite{darwin1859origin}.

Darwin's first tree (Figure~\ref{fig:darwin-tree}) shows the theoretical
relationship between an ancestral species (1) and its descendant species.
Extant species are shown by tips on the endpoints of some branches with the
remaining branches possibly representing extinct species.  His idea was that
groups of species would have diverged at different times and therefore some
groups will be more closely related than others.  For example, the species
labelled by B and C would be more closely related than those labelled by A and
D.

\begin{figure}
  \centering
  \includegraphics[width=20em]{figures/background2/darwin-tree.png}
  \caption{Charles Darwin's first diagram of an evolutionary tree from his
    notebook \textit{Transmutation of species}, 1837 \cite{darwin1837notebook}.}
  \label{fig:darwin-tree}
\end{figure}

Trees as a formally defined mathematical entity, such as the ones will see in
the following sections, appeared as early as 1847 with the name ``tree''
appearing in the literature shortly afterwards \cite{knuth97taocp1}.  The more
general theory of graphs and topology was developed earlier and is considered
to have begun with Euler who in 1735 presented the paper ``Solutio problematis
ad geometriam situs pertinentis'' \cite{euler1735solutio} in which it was
shown that it was not possible to walk through the city of KÃ¶nigsburg crossing
each of its seven bridges exactly once.

Tree structures are of great importance in computer programming.  One of
earliest programs to make explicit use of tree structures used them to
represent algebraic formulae for the purpose of symbolic differentiation
\cite{knuth97taocp1,kahrimanian53differentiation}.  This would later become
the field of computer algebra which would drive the development of computer
science and especially programming languages for many years.

Intuitively, it makes sense to arrange many different types of information in
trees, particularly those for which we have a distance.  A first question to
ask is whether a representation in terms of a tree exists for a given dataset
and distance function.  As we will see, when the distance function satisfies
certain properties there always exists a tree representation and this
representation is also unique (in a well-defined sense).  We focus then on a
slightly different problem: imagine we know the distance between only certain
pairs of objects in our dataset.  We call this information a partial distance.
This presents two separate problems.  First, does there exist a tree
representation of a given partial distance and if so, can we find one?
Second, does there exist a unique tree representation of a given partial
distance, and if so can we find it?  These issues are the subject of the
remainder of this thesis.

\subsection{Basic terminology and assumptions}
\label{sec:basic-term-assumpt}

In this section we introduce much of the terminology that is required for
dealing with trees.  Since trees are special cases of graphs, we begin with
general graph theory before moving on to trees and then a special type of tree
that is of greatest interest to us.  As noted by Knuth \cite{knuth97taocp1}
there is a large degree of variation in the terminology used by different
authors in graph theory.  We try to follow the terminology used in current
phylogenetics literature such as \cite{semple2003phylogenetics} and
\cite{DHS11}.  Throughout this section, let $X$ denote a finite nonempty set.

\subsubsection{Graphs}
\label{sec:graphs}

A \textit{graph} is an ordered pair $(V,E)$ where $V$ is a set of
\textit{vertices} and $E$ is a set (or multiset) of \textit{edges}, each of
the form $\{x,y\}$ such that $x,y \in V$ are distinct.  Unless specified
otherwise, all graphs in this thesis are \textit{simple} and finite meaning
that $V$ and $E$ are finite sets and there are no loops.  Suppose $G = (V,E)$
is a graph. Two vertices $v,v' \in V$ are said to be \textit{adjacent} if
there exists an edge in $G$ joining $v$ and $v'$.  An edge $\{x,y\} \in E$ is
said to be \textit{incident} with the vertices $x$ and $y$.  The
\textit{degree} of a vertex $v \in V$ is the number of edges in $G$ incident
with it.

\begin{figure}
  \centering
  \input{figures/background2/graph-ex.pdft}
  \caption{A graph (i) and a directed graph (ii).}
  \label{fig:graph-ex}
\end{figure}

A \textit{path} is a sequence of distinct vertices $v_1,v_2,\dotsc,v_k$ where
$k \geq 2$ such that for all $i \in \{1,\dotsc,k-1\}, v_i$ and $v_{i+1}$ are
adjacent.  If $k \geq 3$ and $v_1$ and $v_k$ are also adjacent then the path
is called a \textit{cycle}.  A graph is \textit{connected} if there exists a
path joining each pair of distinct vertices.  A graph is \textit{complete} if
there is an edge joining each pair of distinct vertices.  A subset of $V$ is
called a \textit{clique} if there is an edge joining each pair of distinct
vertices in $V$.  Figure~\ref{fig:graph-ex} helps to illustrate these
definitions.  In the graph shown in (i) an example of a path is $g,f,e,d$ and
an example of a cycle is $g,f,b,a,g$.  The graph is connected, but not
complete, and the set $\{a,b,g,f\}$ is a clique.

A \textit{directed graph} is an ordered pair $(V,E)$ where $E$ is a set of
\textit{directed edges} or \textit{arcs}.  An arc $(v,v') \in E$ is said to
lead from $v$ to $v'$.  The \textit{out-degree} of a vertex is the number of
arcs leading out from it and the \textit{in-degree} is the number leading in.
The degree of a vertex is therefore the sum of its out-degree and in-degree.
An \textit{oriented path} is a sequence of distinct vertices $v_1,\dotsc,v_k$
such that there exists an arc from $v_i$ to $v_j$ for all $1 \leq i \leq k-1$.
Figure~\ref{fig:graph-ex} (ii) shows a directed graph to help illustrate these
definitions.  Vertex $f$ has out-degree 3, in-degree 1 and therefore degree 4.
An example of an oriented path is $e,f,b,c$.

Two graphs $(V,E)$ and $(V',E')$ are called \textit{isomorphic} if there
exists a bijection $\phi \colon V \to V'$ such that $\{v,v'\} \in E$ if and
only if $\{\phi(v),\phi(v')\} \in E'$.  So, in other words, adjacency of
vertices is preserved.  A graph $(V',E')$ is a \textit{subgraph} of a graph
$(V,E)$ if $V' \subseteq V$ and $E' \subseteq E$.  Further if $V' \subseteq V$
and $E'$ contains all edges $\{v,v'\} \in E$ whenever $v,v' \in V'$ the graph
$(V',E')$ is an \textit{induced subgraph} of $(V,E)$.

\subsubsection{Trees}
\label{sec:trees}

A graph that is connected and has no cycles is called a \textit{tree}.  Trees can be
characterised in many ways, some of which are given in the following theorem
(see \citep[][Section 2.3.4.1]{knuth97taocp1} for a proof):

\begin{thm}
  If $G$ is a finite graph with $n > 0$ vertices, the following statements are
  equivalent:
  \begin{enumerate}[label=\alph*)]
  \item $G$ is a tree,
  \item $G$ is connected, but if any edge is deleted the resulting graph is no
    longer connected,
  \item There is exactly one path between any two distinct vertices of $G$,
  \item $G$ contains no cycles and has $n-1$ edges,
  \item $G$ is connected and has $n-1$ edges.
  \end{enumerate}
\end{thm}

A \textit{rooted tree} (or \textit{oriented tree}) is a directed graph $G$
with a distinguished vertex $\rho_G$ (the root) such that
\cite{knuth97taocp1}:
\begin{enumerate}[label=\alph*)]
\item Each vertex $v$ of $G$ apart from $\rho_G$ has in-degree 1,
\item The root $\rho_G$ has in-degree 0,
\item There is a path between $\rho_G$ and any vertex of $G$ that is not the
  root.
\end{enumerate}

\begin{figure}
  \centering
  \input{figures/background2/x-tree-ex.pdft}
  \caption{A phylogenetic $X$-tree (i) and a rooted phylogenetic $X'$-tree
    (ii).}
  \label{fig:x-tree-ex}
\end{figure}

A vertex in a tree is called a \textit{leaf} if it has degree 1.  All other
vertices are called \textit{interior} vertices.  An edge which is incident
with a leaf is called a \textit{pendant} edge.  All other edges are called
\textit{interior} edges.  The set of all leaves of a tree $T$ is called the
\textit{leafset} of $T$ which we denote by $L(T)$.

Suppose $X$ is a finite, nonempty set, a \textit{phylogenetic $X$-tree}
($X$-tree for short) is a tree with no degree 2 vertices and leafset $X$.  A
\textit{rooted phylogenetic $X$-tree} is a rooted tree with no vertices of
in-degree one and out-degree one and with leafset $X$.
Figure~\ref{fig:x-tree-ex} shows an $X$-tree with $X = \{a,\dotsc,g\}$ and a
rooted $X'$-tree with $X' = \{a,\dotsc,f\}$.  Since the remainder of this
thesis is concerned with rooted trees we will from now on refer to a rooted
phylogenetic $X$-tree as simply an \textit{$X$-tree}.

An \textit{edge-weighted graph} $(G,\omega)$ is a graph $G=(V,E)$ paired with
an edge-weighting function $\omega \colon E \to \rr$.  For an edge-weighted
$X$-tree $T$ we call an edge-weighting \textit{proper} if $w(e) > 0$ for every
interior edge $e$ of $T$.

An $X$-tree has a natural partial order on the vertices.  Given an $X$-tree
$T=(V,E)$, a vertex $v \in V$ is an \textit{ancestor} of a vertex $v' \in V$
if and only if $v$ is on the directed path from the root of $T$ to $v'$.  The
vertex $v'$ is then said to be a \textit{descendant} of $v$.  If $v$ and $v'$
are adjacent then we also call $v$ the \textit{parent} of $v'$ and $v'$ a
\textit{child} of $v$.  The number of children of a particular vertex equals
its out-degree.

We call two $X$-trees $T$ and $T'$ \textit{equivalent} (written $T \simeq T'$)
if there exists a bijection $\phi \colon V(T) \to V(T')$ which preserves
adjacency and is the identity on $X$.  Since an $X$-tree is rooted, $\phi$
must also map $\rho_{T}$ to $\rho_{T'}$.  This means that $T$ and $T'$ are
necessarily isomorphic.

An $X$-tree is \textit{binary} if all interior vertices have degree 3 apart
from the root which has degree 2.  We therefore have that each vertex has
out-degree zero or two and each vertex apart from the root has in-degree 1.
By considering the directed paths from the root to leaves it becomes clear why
such a tree is called binary \cite{semple2003phylogenetics}.

The \textit{lowest common ancestor} of two vertices $v$ and $v'$ in an
$X$-tree is the unique vertex $u$ such that $u$ is an ancestor of both $v$ and
$v'$ and the path from the root $\rho$ to $u$ is longer than the path to any
other ancestor of both $v$ and $v'$.  The lowest common ancestor of $v$ and
$v'$ is denoted $\lca(v,v')$.  In the $X'$-tree in Figure~\ref{fig:x-tree-ex}
(ii) the lowest common ancestor of $a$ and $d$ is the root $\rho$.

A connected subgraph of a tree is called a \textit{subtree}.  If $T$ is an
$X$-tree and $X' \subseteq X$ then we denote by $T|X'$ the subtree of $T$
whose leafset is $X'$, with degree 2 vertices suppressed.  $T|X'$ is then
called a \textit{restricted subtree}.  If $T$ is binary and $|X'| = 3$ then
$T|X'$ is called a \textit{triplet}.

For a set $X$ the number of possible binary $X$-trees is $(2|X|-3)!!$.
Therefore to find a tree in this space with particular properties we cannot
look at each possible tree and must instead use a special tree reconstruction
method.  Next we look at how distances are related to trees and then at the
problem of reconstructing a tree from distance information.

\subsubsection{Distances}
\label{sec:distances}

Given an edge-weighted $X$-tree $(T,\omega)$ where $T=(V,E)$ and $\omega
\colon E \to \rrnn$ we can associate a distance $D_{(T,\omega)} \colon X
\times X \to \rrnn$ to $(T,\omega)$ by setting for all $x,y \in X$:
\begin{equation*}
  D_{(T,\omega)}(x,y) =
  \begin{cases}
    \displaystyle
    \sum_{e \in P(x,y)} \omega(e) & \text{if $x \neq y$},\\
    0 & \text{otherwise,}
  \end{cases}
\end{equation*}
where $P(x,y)$ is the set of edges on the path from $x$ to $y$.  We call
$D_{(T,\omega)}$ the distance \textit{induced} by $(T,\omega)$.  A distance
$\delta \colon X \times X \to \rr$ is called a \textit{tree metric} if there
exists an $X$-tree $T=(V,E)$ with edge-weighting $\omega \colon E \to \rrnn$
such that $\delta(x,y) = D_{(T,\omega)}(x,y)$ for all $x,y \in X$.  So for any
edge-weighted $X$-tree $(T,\omega)$, the distance $D_{(T,\omega)}$ is a tree
metric.

\begin{figure}
  \centering
  \input{figures/background2/quartet.pdft}
  \caption{An $\{w,x,y,z\}$-tree with four leaves used to illustrate the
    four-point condition.}
  \label{fig:quartet-tree}
\end{figure}

The \textit{four-point condition} allows us to decide whether a given distance
is in fact a tree metric \cite{semple2003phylogenetics}.  A distance $\delta
\colon X \times X \to \rr$ satisfies the four-point condition if for every
$w,x,y,z \in X$ the following holds:
\begin{equation*}
  \delta(w,x) + \delta(y,z) \leq \max(\delta(w,y)+\delta(x,z),
                                      \delta(w,z)+\delta(x,y)).
\end{equation*}
Since the elements $w,x,y,z$ need not be distinct it is easy to see that if
$\delta$ satisfies the four-point condition then it satisfies the triangle
inequality and is therefore a metric.  Further, $\delta$ is a tree metric on
$X$ if and only if it satisfies the four-point condition
\citep[Theorem 7.2.6]{semple2003phylogenetics}.

To illustrate the fact that an induced distance $D_{(T,\omega)}$ must satisfy
the four-point condition let $T$ be the tree shown in
Figure~\ref{fig:quartet-tree} and $\omega$ be any proper edge-weighting for
it.  Then it is easy to see that $\DTw(w,x)+\DTw(y,z) < \DTw(w,y)+\DTw(x,z)$
by observing the dotted and dashed lines.  Also $\DTw(w,y)+\DTw(x,z) =
\DTw(w,z)+\DTw(x,y)$, so the distance induced by $T$ and $\omega$ on
$\{w,x,y,z\}$ satisfies the four-point condition.

An important property of tree metrics is that for any tree metric $\delta
\colon X \times X \to \rr$ there is, up to isomorphism of the underlying
$X$-tree, a unique edge-weighted $X$-tree $(T,\omega)$ for which $\delta(x,y)
= D_{(T,\omega)}(x,y)$ holds for all $x,y \in X$.  This tree can be recovered
from the metric in polynomial time \citep{semple2003phylogenetics}.  We will
see some of the methods for doing this in Section~\ref{sec:constr-from-dist}.

A distance $\delta \colon X \times X \to \rr$ is called an
\textit{ultrametric} if for every distinct $x,y,z \in X$ the following holds:
\begin{equation*}
  \delta(x,y) \leq \max(\delta(x,z),\delta(y,z)).
\end{equation*}
Any ultrametric satisfies the four-point condition and is therefore also a
tree metric.

\begin{figure}
  \centering
    \begin{subfigure}[b]{0.5\textwidth}
      \centering
      \input{figures/background2/treeconstruct1.pdft}
      \label{fig:example-equidistant-1}
      \caption{}
    \end{subfigure}%
    ~
  \begin{subfigure}[b]{0.5\textwidth}
    \centering
    \begin{tikzpicture}[yscale=0.35]
    \node (r) at (0.0,0.0) {};
\node (rr) at (-0.2,0.0) {};
\draw (r.center) -- (rr.center);
\node (r1) at (2.0,-3.5) {};
\node[label=right:{$j$}] (r11) at (3.0,-4.5) {};
\draw (r1.center) |- (r11.center);
\node[label=right:{$i$}] (r12) at (3.0,-3.5) {};
\draw (r1.center) |- (r12.center);
\node[label=right:{$h$}] (r13) at (3.0,-2.5) {};
\draw (r1.center) |- (r13.center);
\draw (r.center) |- (r1.center);
\node (r2) at (1.0,0.0) {};
\node[label=right:{$g$}] (r21) at (3.0,-1.5) {};
\draw (r2.center) |- (r21.center);
\node (r22) at (2.0,0.5) {};
\node[label=right:{$f$}] (r221) at (3.0,-0.5) {};
\draw (r22.center) |- (r221.center);
\node[label=right:{$e$}] (r222) at (3.0,0.5) {};
\draw (r22.center) |- (r222.center);
\node[label=right:{$d$}] (r223) at (3.0,1.5) {};
\draw (r22.center) |- (r223.center);
\draw (r2.center) |- (r22.center);
\draw (r.center) |- (r2.center);
\node (r3) at (2.0,3.5) {};
\node[label=right:{$c$}] (r31) at (3.0,2.5) {};
\draw (r3.center) |- (r31.center);
\node[label=right:{$b$}] (r32) at (3.0,3.5) {};
\draw (r3.center) |- (r32.center);
\node[label=right:{$a$}] (r33) at (3.0,4.5) {};
\draw (r3.center) |- (r33.center);
\draw (r.center) |- (r3.center);
\draw[|-|] (2.0,-5.5) -- (3.0,-5.5);
\node at (2.5,-6.5) {1.0};
     \end{tikzpicture}
     \caption{}
     \label{fig:example-equidistant-2}
   \end{subfigure}

   \caption{A dendrogram is a visual representation of a tree.  Here we see
     two different ways to draw the same edge-weighted $X$-tree.}
   \label{fig:example-equidistant}
\end{figure}

An edge-weighting $\omega \colon E \to \rr$ for an $X$-tree $T=(V,E)$ is
called \textit{equidistant} if it satisfies the following properties:
\begin{itemize}
\item[(i)] $D_{(T,\omega)}(\rho_T,x) = D_{(T,\omega)}(\rho_T,y)$ for all $x,y
  \in X$,
\item[(ii)] $D_{(T,\omega)}(x,y) \geq D_{(T,\omega)}(x,u)$ for all $x \in X$
  and any $u,v \in V$ whenever $u$ is encountered before $v$ on the directed
  path from $x$ to $\rho$.
\end{itemize}
If $\omega$ is an equidistant edge-weighting then $D_{(T,w)}$ is an
ultrametric \cite[Lemma 7.2.4]{semple2003phylogenetics}.  $X$-trees with
equidistant edge-weightings arise naturally in many places, for example in
phylogenetics.  For convenience we will from now on refer to such an $X$-tree
with equidistant edge-weighting as simply an \textit{equidistant $X$-tree}.

Figure~\ref{fig:example-equidistant} shows an example of an equidistant
$X$-tree with $X = \{a, \dotsc, j\}$ using two common display formats
(dendrograms).  In (i) the edges are simply labelled with their weights (edges
with weight 1 are left unlabelled for clarity).  In (ii) the weight of each
edge is proportional to the horizontal component of its length on the bar with
the actual length shown with a scale bar.

For any ultrametric $\delta \colon X \times X \to \rr$ there is, up to
isomorphism, a unique equidistant $X$-tree $(T,\omega)$ such that $\delta(x,y)
= D_{(T,\omega)}(x,y)$ for all $x,y \in X$.  As with a general tree metric,
this tree can be recovered from the ultrametric in polynomial time, as we will
see in the next section.

\section{Tree reconstruction}
\label{sec:tree-construction}

In this section we look at various methods of reconstructing trees.  Of most
interest to us is the problem of reconstructing an $X$-tree from a distance on
$X$.  This is generally done by one of two broad classes of hierarchical
clustering methods which we discuss in Section~\ref{sec:hier-clust-meth}.

A further problem is that of reconstructing an edge-weighted $X$-tree from a
distance on $X$.  This is desirable in many cases, for example in
phylogenetics the edge-weights might represent the time or number of point
mutations \cite{felsenstein2004inferring}.

Given a distance $d \colon X \times X \to \rr_{\geq 0}$ and a weighted
$X$-tree $(T,\omega)$ produced by some reconstruction method, we call that
method \textit{consistent} if it satisfies the property that whenever $d$ is a
tree metric on $X$ then $D_{(T,\omega)}(x,y) = d(x,y)$ for all $x,y \in X$.
In other words, if given a tree metric the reconstruction method produced the
unique edge-weighted tree identified by the tree metric.

Closely related to this is the problem of reconstructing $X$-trees from only
partial distance information.  This means that we do not have the complete
distance $d$, but rather only have the values $d(x,y)$ for some, but not all,
pairs $x,y \in X$.  This problem is motivated by the fact that accurate
distance measurements are often difficult or impossible to obtain in practice
but one would still like to build an edge-weighted $X$-tree given only what is
known.

As with complete distance information, it is possible for partial distance
information to uniquely determine an $X$-tree.  This is the subject of
Section~\ref{sec:lassoing-corralling}.  This allows us to define a consistency
property for partial distance reconstruction methods.  Such methods appear in
Chapters~\ref{cha:dist-minim-topl} and \ref{cha:lasso-construction}.

\subsection{Reconstruction from subtrees}
\label{sec:constr-from-subtr}

Before we look at reconstructing trees from distances, it is interesting to
note that we do not actually need a distance to reconstruct only the topology
of an $X$-tree.  It suffices merely to know the set of subtrees displayed by
the tree \cite{semple2003phylogenetics}.

A pair of leaves of an $X$-tree that share the same parent is called a
\textit{cherry}.  An $X$-tree with $|X| = 3$ that contains a cherry is called
a \textit{triplet}.  If $P$ is an $\{a,b,c\}$-tree $a,b$ is a cherry of $P$
then we denote the triplet $P$ by $ab|c$.  We say that a triplet $ab|c$ is
\textit{displayed} by an $X$-tree $T$ if $T|\{a,b,c\}$ is binary and
$lca_T(a,c) = lca_T(b,c)$ is an ancestor of $lca_T(a,b)$ in $T$.

\begin{algorithm}[h]
  \caption{\textsc{Build}.}
  \label{alg:build}

  \begin{algorithmic}
    \Require A set of rooted trees $R = \{T_1,\dotsc,T_n\}$.
    \Ensure  An $X$-tree $T$ where $X = L(T_1) \cup \dotsb \cup L(T_n)$.

    \State $S = \{x_1,\dotsc,x_m\} \gets X$.

    \If{$|S| = 1$} \Return the tree $(\{x_1\},\emptyset)$. \EndIf

    \If{$|S| = 2$} let $\rho$ be a new vertex and \Return the tree with root
    node $\rho$ obtained by attaching $x_1$ and $x_2$ to $\rho$. \EndIf

    \State Construct the auxiliary graph $[R,S]$.

    \State Let $S_1,\dotsc,S_k$ be the vertex sets of the connected components
    of $[R,S]$.

    \ForAll{$1 \leq i \leq k$}
    \State Let $T_i$ be the output of \textsc{Build} on $R_i$ where $R_i =
    \{T|S_i \colon T \in R\}$.
    \EndFor

    \State Let $\rho$ be a new vertex and \Return the tree with root node
    $\rho$ obtained by attaching the root of each $T_i$ to $\rho$.
    
  \end{algorithmic}
\end{algorithm}

\begin{figure}
  \centering
  \input{figures/background2/build-ex2.pdft}
  \caption{An illustration of \textsc{Build} with an input of $R =
    \{T_1,T_2\}$.  $[R,S]$ is the auxiliary graph built in the first iteration
    of the algorithm and $T$ is the final tree constructed.}
  \label{fig:build-ex}
\end{figure}

The \textsc{Build} algorithm \cite{aho1981inferring} can reconstruct an
$X$-tree $T$ from the set $\{T|S \colon S \subseteq X, |S| = 3 \text{ and }
T|S \text{ is binary}\}$ of all triplets displayed by $T$.  We show the
\textsc{Build} algorithm in pseudocode in Algorithm~\ref{alg:build} and show
an example in Figure~\ref{fig:build-ex}.  The algorithm uses a set of rooted
trees $\{T_1,\dotsc,T_n\}$ where $L(T_1) \cup \dotsb \cup L(T_n) = X$ and an
auxiliary graph $[R,S]$ which has vertex set $S \subseteq X$ and an edge
$\{a,b\}$ for each $a,b \in S$ whenever there exists some $c \in S$ and some
$T' \in R$ such that $T'|\{a,b,c\}$ and $ab|c$ are equivalent.

If \textsc{Build} returns a tree then the set of input trees is said to be
\textit{compatible}.  Furthermore, if we input the set of all triplets
displayed by a tree $T$, then \textsc{Build} will output $T$ and therefore $T$
is uniquely determined by the set of triplets it displays
\cite{semple2003phylogenetics}.

If the inputted set of triplets $R$ is some subset of all the triplets
displayed by a tree then the set is still compatible but this set is displayed
by possibly many trees.  In this case the output of \textsc{Build} is
deterministic and the tree reconstructed is known as \textit{the
  \textsc{Build} tree for $R$}.  Some interesting properties of these trees
can be found in \cite[Section 2.5.2]{bryant97buildingtrees}.

The \textsc{Build} algorithm was initially developed to construct a tree
satisfying a given set of constraints and was applied to problems arising in
the theory of relational databases.  It was later applied to phylogenetics but
remained relatively unknown in the field for a number of years
\cite{steel1992complexity,bryant04supertree}.

\subsection{Reconstruction from distances}
\label{sec:constr-from-dist}

We now turn to the problem of reconstructing an $X$-tree from a distance.  We
begin with a brief overview of general hierarchical clustering methods and
then look at the UPGMA method \cite{sokal1958statistical} and its optimal
runtime algorithm.  Hierarchical clustering methods in general build
unweighted $X$-trees, but UPGMA can be considered an extension which also
builds an edge-weighting for the constructed tree.

For a distance-based reconstruction method the following property is
desirable: if we input a distance function $D_{(T,\omega)}$ induced by an
edge-weighted $X$-tree $(T,\omega)$ we get the tree $T$ and its edge-weighting
$\omega$.  If a method enjoys this property then we call it
\textit{consistent}.  For many methods this property holds only under certain
conditions.  For UPGMA this holds if $(T,\omega)$ is a binary equidistant
$X$-tree \cite{durbin1998biological}.

\subsubsection{Hierarchical clustering methods}
\label{sec:hier-clust-meth}

\begin{figure}
  \centering
  \input{figures/background2/tree-clust-ex.pdft}
  \caption{A tree can be viewed as a hierarchy of partitions.}
  \label{fig:tree-clust-ex}
\end{figure}

Hierarchical clustering is used for the classification of information in much
the same way as partitional clustering.  The aim of a hierarchical clustering
method is to produce an $X$-tree corresponding to a distance $D$ on a set $X$.
While a partition of a set is merely a set of disjoint subsets (clusters)
which cover the set, an $X$-tree can be viewed as a hierarchy of such clusters
which induces several partitions on $X$.  This natural relationship between
trees and partitions is shown in Figure~\ref{fig:tree-clust-ex}.  In the
example we have $X = \{a,\dotsc,e\}$.  The root of the tree corresponds to the
single cluster $X$ (denoted $abcde$) and as we move down the tree the set is
partitioned further until we have cluster of one leaf each (denoted
$a|b|c|d|e$).

There are two main methods in use for building hierarchies.  These are the
\textit{agglomerative} or ``bottom-up'' methods which begin with each element
of $X$ in its own cluster and successively merges clusters until there is only
one cluster left, and the \textit{divisive} or ``top-down'' methods which
begin with a single cluster and successively splits clusters until each
element is on its own.  The resulting hierarchy depends upon which merges or
splits have been chosen at each stage which, in turn, depends on finding a
local optimum according to some criterion.

\begin{algorithm}[h]
  \caption{Agglomerative hierarchical clustering algorithm.}
  \label{alg:agglomerative}

  \begin{algorithmic}
    \Require A set $X$, a distance $d \colon X \times X \to \rr$, and a
    linkage function $D \colon 2^X \times 2^X \to \rr$.
    \Ensure  A rooted $X$-tree $T$.

    \State Let $F$ be a forest of $|X|$ trees each containing a unique element
    of $X$ as the only vertex, which is also the root,

    \While{$|F| > 1$}

       \State Let $v$ be a new vertex and $\displaystyle (x,y) \gets \argmin_{x,y
         \in F} D(L(x),L(y))$,
       \State Remove trees $x$ and $y$ from $F$ and add the tree obtained by
         attaching the roots of $x$ and $y$ to $v$ and letting $v$ be the root,
    
    \EndWhile

    \State \Return the single tree contained in $F$.
    
  \end{algorithmic}
\end{algorithm}

The general algorithm for agglomerative clustering is shown in
Algorithm~\ref{alg:agglomerative}.  The choice of linkage function determines
how the distances are recomputed at each stage and therefore which trees are
joined in each subsequent stage.  Given a set $X$ and distance $d \colon X
\times X \to \rr$ and two nonempty subsets $S_1,S_2 \subseteq X$, some common
choices for linkage functions include single-linkage:
\begin{equation*}
  \label{eq:slink}
  D_{SL}(S_1,S_2) = \min_{x \in S_1, y \in S_2} d(x,y),
\end{equation*}
complete-linkage:
\begin{equation*}
  \label{eq:clink}
  D_{CL}(S_1,S_2) = \max_{x \in S_1, y \in S_2} d(x,y),
\end{equation*}
and average-linkage:
\begin{equation*}
  \label{eq:alink}
  D_{AL}(S_1,S_2) = \left( \sum_{x \in S_1} \sum_{y \in S_2} d(x,y) \right) / |S_1| |S_2|.
\end{equation*}

The general algorithm for agglomerative clustering has runtime complexity of
$O(n^3)$ where $n = |X|$ since there are $O(n)$ merges to be done and finding
the $\argmin$ takes $O(n^2)$ time.  However, for many linkage criteria,
including the three above, it is possible to use an $O(n^2)$ algorithm as we
will see in the next section.

The divisive method works in the opposite direction: we begin with a single
cluster and successively split clusters until we end up with one cluster per
leaf.  Divisive methods are usually significantly more complicated than
agglomerative methods.  Each step requires an initial decision about which
cluster to split, and then a decision about how to split that cluster
\cite{savaresi2002cluster}.  A naÃ¯ve approach for deciding which cluster to
split next is to always split the largest cluster, but there are more
sophisticated approaches, for example based on cluster homogeneity.  Splitting
a cluster then essentially requires a partitional clustering method
\cite{ding2002cluster}.  In general the time complexity of a divisive method
is $O(2^n)$ where $n = |X|$ making it prohibitively expensive for most
applications \cite{cimiano2004comparing}.

\subsubsection{UPGMA}
\label{sec:upgma}

The UPGMA method is in fact a modified agglomerative clustering method using
average-linkage which reconstructs an edge-weighted $X$-tree.  The
edge-weighting constructed by UPGMA is always equidistant.

For an equidistant $X$-tree $(T,\omega)$, let $height((T,\omega))$ be the
length of the path from the root of $T$ to any leaf, that is $\sum_{e \in P}
D_{(T,\omega)}$ where $P$ is a path from $\rho_T$ to a leaf in $X$, or 0 if
the root is the sole vertex.  The algorithm for UPGMA is shown in
Algorithm~\ref{alg:upgma}.

\begin{algorithm}[h]
  \caption{UPGMA.}
  \label{alg:upgma}

  \begin{algorithmic}
    \Require A set $X$, and a distance $d \colon X \times X \to \rr$.
    \Ensure  A binary equidistant $X$-tree $(T, \omega)$.

    \State Let $F$ be a forest of $|X|$ trees each containing a unique element
    of $X$ as the only vertex, which is also the root.

    \While{$|F| > 1$}

       \State Let $v$ be a new vertex,
       \State put $\displaystyle m \gets \min_{x,y \in F} D_{AL}(L(x),L(y))$,
       \State and $\displaystyle (x,y) \gets \argmin_{x,y \in F} D_{AL}(L(x),L(y))$.
       \State Remove trees $x$ and $y$ from $F$ and add the tree obtained by
         attaching the root of $x$ to $v$ with an edge of length $m/2 -
         height(x)$, attaching the root of $y$ to $v$ with an edge of length
         $m/2 - height(y)$ and letting $v$ be the root.
    
    \EndWhile

    \State \Return the $X$-tree contained in $F$ and its edge-weighting.
  \end{algorithmic}
\end{algorithm}

Since only two trees are joined in each iteration, the output of UPGMA is
always a binary tree.  If the input $d$ is equal to the induced distance
$D_{(T,\omega)}$ of some equidistant $X$-tree $(T,\omega)$ then UPGMA will
return $(T,\omega)$ \cite{durbin1998biological}.

% mention general method for other linkage criteria

% However, for all three of the linkage
% functions above there are special algorithms which run in only $O(n^2)$ time,
% these are SLINK \citep{sibson1973slink}, CLINK \citep{defays1977efficient} and
% UPGMA respectively.  The following section discusses .

In the general agglomerative algorithm, each step involves identifying a pair
of elements such that no other pair of elements in $X$ are closer according to
the linkage criterion.  In other words, we are finding a global minimum.  In
more efficient algorithms we instead look only for a local minimum at each
stage.  A local minimum in this context means a pair of elements which are
\textit{mutual nearest neighbours} (MNNs).  Given a set $X$ and a distance $d$
on $X$, a pair $x,y \in X$ are MNNs if there exists no element $z \in X$ for
which $d(x,z) < d(x,y)$ or $d(y,z) < d(x,y)$.  Such a pair can be safely
agglomerated just as in the general algorithm for certain linkage criteria,
including average-linkage \cite{murtagh2011methods}.

Finding MNNs can be done quickly by building a chain of nearest neighbours in
the following way: we begin with an arbitrary cluster in $X$ and find its
nearest neighbour giving us a chain of length two.  We then repeatedly add to
the chain the nearest neighbour of the last element in the chain until we find
a pair of MNNs.  The MNNs are removed from the chain and agglomerated.  The
distances between new clusters are calculated recursively using the
Lance-Williams update formula \cite{lance66theory}.  The process is then
continued from the end of the chain, or from an arbitrary cluster if the chain
is empty.

This method was developed in the early 1980s and initially appeared in
\cite{de1980classification} and \cite{juan1982programme} (in French) and later
in \cite{murtagh1983survey} and \cite{murtagh1984complexities} (in English).
It leads to the optimal $O(n^2)$ version of UPGMA \cite{gronau2007optimal}.

\subsection{Reconstruction from partial distances}
\label{sec:constr-from-part}

A partial distance on a set $X$ is a distance where the distance between some
pairs of elements is missing.  Partial distances arise often in practice.  It
is sometimes difficult or impossible to make measurements between certain
pairs due to those pairs not sharing any information from which a distance can
be inferred.  For example, in biological studies involving large numbers of
species and genes it is often the case that species do not share any genes in
the available data \cite{criscuolo2008fastnj}.

For this reason it becomes useful to ask whether such a partial distance can
be extended into a complete distance that is also a tree metric or
ultrametric.  Put differently, a partial distance is a function $d \colon X
\times X - M \to \rrnn$ where $M$ is the set of pairs for which the distance
value is missing.  The problem is to find a complete distance $d \colon X
\times X \to \rrnn$ where $d(x,y) = d^*(x,y)$ for all $x,y \in X \times X - M$
and which is a tree metric or ultrametric.  In \citep{farach1995robust} it was
shown that the problem of deciding whether such an extension to a tree metric
exists is NP-complete but the special case of an extension to an ultrametric
is in P.

Below we describe three different methods given in the literature for
extending a partial distance to an ultrametric and reconstructing an $X$-tree.
There are also many methods that have been devised for the more general
problem of extension to a tree metric which we do not review but can be found
in, for example, \citep{guenoche1999approximations}, \citep{farach1995robust},
\citep{makarenkov2001nouvelle} and \citep{guenoche2004extension}.

\subsubsection{An optimisation method}
\label{sec:part-dist-optim-method}

The approach taken by \citet{de1984ultrametric} is to consider a least squares
constrained optimisation problem.  Given a partial distance $d^* \colon
X^2 - M \to \rrnn$ we wish to find a function $d \colon X^2 \to \rrnn$
such that
\begin{equation*}
  \label{eq:partial-dist-least-squares}
  Loss(d) = \sum_{(x,y) \in X^2 - M} (d^*(x,y)-d(x,y))^2
\end{equation*}
is minimised and $d$ is an ultrametric.  The method used is a sequential
unconstrained minimisation technique.  The constraint that $d$ must be an
ultrametric is removed and instead we find a distance $d_n \colon X^2 \to
\rrnn$ which minimises the augmented function:
\begin{equation*}
  \label{eq:partial-dist-optimisation}
  \Phi(d_n,\sigma) = Loss(d_n) + \sigma Pen(d_n), \qquad (\sigma > 0).
\end{equation*}
The function $Loss$ is called the \textit{loss function} and $Pen$ is the
\textit{penalty function} which is meant to enforce the ultrametric
condition.  $Pen$ is defined as:
\begin{equation*}
  \label{eq:penalty-function}
  Pen(d_n) = \sum_{(i,j,k) \in \Omega(d_n)} (d_n(i,k) - d_n(j,k))^2
\end{equation*}
where
\begin{equation*}
  \Omega(d_n) = \{(i,j,k) \in X^3 \colon d(i,j) \leq \min(d_n(i,k),d_n(j,k))
  \text{ and } d_n(i,k) \neq d_n(j,k)\}.
\end{equation*}
In other words, $\Omega(d_n)$ denotes the set of $3$-tuples for which the
ultrametric condition is violated.  The unconstrained minimisation is
performed successively with an increasing value for $\sigma$, each time using
the previous result $d_{n-1}$ to begin the search for the next $d_n$.  To
perform the unconstrained minimisation of the augmented function, a method by
\citet{powell1977restart} is used.

\subsubsection{An agglomerative method}
\label{sec:part-dist-agglom-method}

Missing Values Linkage (MVL) is an example of an agglomerative approach
proposed by \citet{schader1992mvl}.  It is actually identical to the
agglomerative hierarchical clustering algorithm (see
Section~\ref{sec:hier-clust-meth}) but using a linkage criterion modified to
take into account missing values.

The modified
average-linkage criterion for two nonempty sets $S_1, S_2$ is:
\begin{equation*}
  D_{MVL}(S_1,S_2) =
  \begin{cases}
    \displaystyle
    \frac{(\sum_{(x,y) \in S_1 \times S_2 - M} d(x,y)}{|S_1 \times S_2 - M|} & \text{if $S_1
      \times S_2 - M \neq \emptyset$,} \\
    \infty & \text{otherwise},
  \end{cases}
\end{equation*}
where $M = \{(i,j) \in X^2 \colon d(i,j) \text{ is unknown}\}$.  Modified
versions of other linkage criteria are possible and some more examples are
given in the original paper.

The authors do not provide an algorithm with better time complexity than that
of the naÃ¯ve $O(n^3)$ agglomerative algorithm (where $n = |X|$).  They also
show that the MVL method produces very similar results to
\citeauthor{de1984ultrametric}'s method.

\subsubsection{A divisive method}
\label{sec:part-dist-divisive-method}

\citet{farach1995robust} use a top down, divisive approach.  Given a partial
distance function $d^* \colon X \times X - M \to \rrnn$ let $G=(V,E)$ be a
graph with vertex set $X$ and an edge $\{x,y\}$ with $x,y \in X$ but $(x,y)
\notin M$ (so the distance between $x$ and $y$ is known).  We also define an
edge-weighting $\omega \colon E \to \rr$ by $\omega(\{x,y\}) = d^*(x,y)$ for
all $x,y \in E$.

The tree reconstruction algorithm proceeds as follows:
\begin{enumerate}
\item If $E = \emptyset$, return the single element in $V$.
\item Otherwise, put $m \gets max_{e \in E} \omega(e)$.
\item Let $G^* = (V,E^*)$ be a graph and put $E^* \gets \{e \in E \colon
  \omega(e) < m\}$.
\item Let $u$ be a new vertex and return the tree with root node $u$ obtained
  by recursing on each connected component of $G^*$ and attaching the results
  of each to $u$.
\end{enumerate}
This basic algorithm shown here requires $O(|V||E|)$ time but a quicker
algorithm requiring only $O(|E| + |V|\log |V|)$ time is also given by
\citet{farach1995robust}.

\section{Lassos}
\label{sec:lassoing-corralling}

All of the methods for reconstructing a tree from a partial distance
listed in Section~\ref{sec:constr-from-part} have one thing in common: the
tree produced in undefined when more than one extension to an ultrametric is
possible.

Certain partial distances on $X$ have the property that they uniquely
determine the topology or edge-weights of an $X$-tree.  In other words, only
one extension to an ultrametric on $X$ is possible.  To enable us to
understand when partial distances have this uniqueness property, the theory of
lassos was developed.

In this section we define certain types of lassos as applied to equidistant
$X$-trees and look at some important characterisations.

\subsection{Definitions and basic properties}
\label{sec:defin-basic-prop}

Let $(T,\omega)$ and $(T',\omega')$ be two edge-weighted $X$-trees and $\cL
\subseteq {X \choose 2}$ be some subset of pairs of elements in $X$.  For
convenience we denote an element $\{x,y\} \in \cL$ as simply $xy$.  Then
$(T,\omega)$ and $(T',\omega')$ are called \textit{$\cL$-isometric} if
$D_{(T,\omega)}(x,y) = D_{(T',\omega')}(x,y)$ for all $xy \in \cL$.

Now, given an $X$-tree $T$ and a subset $\cL \subseteq {X \choose 2}$ we
define $\cL$ to be:
\begin{enumerate}[label=(\roman*)]
\item an \textit{equidistant lasso} for $T$ if $\omega = \omega'$ holds for
  all equidistant edge-weightings $\omega,\omega'$ of $T$ where $(T,\omega)$
  and $(T,\omega')$ are $\cL$-isometric,
\item a \textit{topological lasso} for $T$ if $T$ is equivalent to $T'$ for
  any $X$-tree $T'$ for which there exist proper edge-weightings $\omega$ and
  $\omega'$ of $T$ and $T'$ respectively where $(T,\omega)$ and $(T',\omega')$
  are $\cL$-isometric,
\item a \textit{strong lasso} $T$ if $\cL$ is both an equidistant and
  topological lasso for $T$.
\end{enumerate}

\begin{figure}
\begin{center}
\input{figures/background2/lasso-example.pdft}
\end{center}
\caption{Two equidistant $X$-trees.  All edges have weight 1 except bold edges
  which have weight 2.  For $\cL=\{ac,de,bc,ce,cd\}$ both trees induce the
  same distances over the cords in $\cL$ despite having different topologies.
  In this case $\cL$ is not a topological lasso.}
\label{fig:lasso-example}
\end{figure}

To illustrate these concepts consider the two equidistant $X$-trees
$(T,\omega)$ and $(T',\omega')$ depicted in Figure~\ref{fig:lasso-example}.
The edge-weights on the edges are proportional to the length of the edges as
shown and induce distances $D_{(T,\omega)} \colon X \times X \to \rr$ and
$D_{(T',\omega')} \colon X \times X \to \rr$ respectively.  The trees are
therefore equidistant.  If we have the set of cords $\cL=\{ac,de,bc,ce,cd\}$
then notice that the distances between each of these pairs of leaves is the
same according to the induced distances for both trees (for example
$D_{(T,\omega)}(a,c) = D_{(T',\omega')}(a,c)$).  Therefore $\cL$ is not a
topological lasso.  Notice that this property of $\cL$ is dependent solely on
the structure of the set itself and not on the actual distances on the trees.

For further information and discussion about lassos, especially those
concerning more general trees, the reader is referred to \cite{DHS11} and
\cite{huber2014tree}..

\subsection{Characterising lassos: the child-edge graph}
\label{sec:lassoing-rooted-x}

Lassos for $X$-trees can be characterised using a graph associated to each
interior vertex of a tree \citep{HP13}.  First, a lasso $\cL$ of $X$ which
satisfies the property that $\bigcup_{c \in \cL} c = X$ is called a
\textit{covering} of $X$.  Let $T$ be an $X$-tree and $\iV(T)$ denote the set
of internal vertices of $T$.  For some $v \in \iV(T)$, and a set of cords $\cL
\subseteq {X \choose 2}$, we associate a graph called $G(\cL,v)$ defined as
follows.  The vertex set of the graph $V_v$ is the set of all child edges of
$v$.  The edge set $E_v$ is the set of all $\{e,e'\} \in {V_v \choose 2}$ for
which there exist leaves $a,b \in X$ and a cord $ab \in \cL$ such that $e$ and
$e'$ are edges on the path from $a$ to $b$ in $T$.  We call the graph
$G(\cL,v)$ the \textit{child-edge graph} (\textit{of $v$ with respect to $T$
  and $\cL$}).

We have the following characterisation of topological lassos which originally
appeared in \cite{HP13}:
\begin{lem}
  \label{lem:child-edge-graph-complete}
  Suppose $T$ is an $X$-tree and $\cL \subseteq {X \choose 2}$ is a covering
  of $X$.  Then the following are equivalent:
  \begin{enumerate}
  \item $\cL$ is a topological lasso for $T$,
  \item for every vertex $v \in \iV(T)$, the graph $G(\cL,v)$ is complete.
  \end{enumerate}
\end{lem}

Due to the characterisation of equidistant lassos also presented in
\cite{HP13}, we also have that every topological lasso for $T$ must also be an
edge-weight lasso, and therefore a strong lasso, for $T$.

%%% Local Variables:
%%% TeX-master: "thesis"
%%% End:
